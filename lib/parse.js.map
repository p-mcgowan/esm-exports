{"version":3,"sources":["..\\src\\parse.ts"],"names":[],"mappings":"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","file":"parse.ts","sourcesContent":["/// <reference path=\"../node_modules/typescript/lib/lib.es6.d.ts\" />\nimport * as ts from \"typescript\";\nimport * as path from \"path\";\nimport {find, flatten} from \"lodash\";\nimport main from \"./main\";\nconst isRelative = require(\"is-relative-path\");\nconst unixify = require(\"unixify\");\n\nexport default function parse(sourceText: string, options?: any) {\n    var entryList: Array<any> = [];\n    var sourceFile = ts.createSourceFile(\"dummy.ts\", sourceText, ts.ScriptTarget.ES6, false);\n    var {dirname, module, file} = options;\n    sourceFile.statements.forEach((node: any) => {\n        if (node.kind === ts.SyntaxKind.ExportDeclaration) {\n            var specifier = node.moduleSpecifier.text;\n            var exportAll = true;\n            var names = [null];\n            if (node.exportClause) {\n                names = node.exportClause.elements.map(n => n.name.text);\n            }\n            names.forEach(name => entryList.push({ name, specifier, exportAll, dirname }));\n        } else if (find<ts.Node>(node.modifiers, m => m.kind === ts.SyntaxKind.ExportKeyword)) {\n            // TODO: Combine ifs later.\n            if (node.declarationList) {\n                node.declarationList.declarations.forEach(d => {\n                    var name = d.name.text;\n                    entryList.push({ name, module });\n                });\n            } else if (node.name) {\n                var name = node.name.text;\n                var {specifier, baseDir} = options;\n                if (specifier && isRelative(specifier)) {\n                    var relative: string = unixify(path.relative(baseDir, file));\n                    var exact = `${module}/${relative.slice(0, -(\".d.ts\".length))}`;\n                }\n                entryList.push({ name, module, relative, exact, specifier});\n            }\n        }\n    });\n    return Promise.all(entryList.map(item => {\n        if (!item.exportAll) {\n            return item;\n        }\n        return main(item.specifier, { baseDir: dirname, parent: module, specifier: item.specifier });\n    }))\n        .then(result => {\n            return flatten<any>(result);\n        });\n}"]}